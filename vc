 ; ~Format=ANSI.S~
%RO 2017-08-25 22:32
vc
vc  ; Interface to external version control
    ;
    q
    ;
    ; Export all routines in ^ROUTINE to version control subdirectory
    ;
    ; TODO: delete routine, add new routine
    ;
export
    w "Exporting routines for version control...",!
    s dir="c:\minimDat\"_$znspace_"\"
    s rnm=""
    f  s rnm=$o(^ROUTINE(rnm)) q:rnm=""  d
    . w rnm,!
    . s expFnm=dir_rnm
    . s io=$io
    . s dev="|FILE|"_expFnm o dev:("wtn"):1 e  u io d  q
    . . i show w "Failed to use ",expFnm,!
    . u dev
    . w " ; ~Format=ANSI.S~",!
    . w "%RO Version Control",!
    . ; write all routines line-by-line using ANSI format
    . s n=0
    . w rnm,!
    . s line=0 f  s line=$o(^ROUTINE(rnm,line)) q:+line'=line  s s=^ROUTINE(rnm,line) s:s="" s=" " w s,!
    . w ! ; end of routine
    . u io
    . c dev
    q
    ;
    ; Import all routines from the version control subdirectory
    ;
importAll
    w "Importing routines from version control...",!
    s dir="c:\minimDat\"_$znspace_"\"
    ; get the list of files in the version control directory
    s dev="|PIPE|dir /b "_dir
    o dev:("rt")
    n $et="g endDir"
    u dev
    f  r fname d
    . d importOne(dir,fname)
endDir
    s $et=""
    c dev
    u $p
    q
    ;
    ; import a routine from version control
    ;
importOne(dir,fname) n fullPath,list
    s fullPath=dir_fname
    s list=""
    d import^%RI(fullPath,list)
    q
    
 



